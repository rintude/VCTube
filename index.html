<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VCTube</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0b141a;
  color:#fff;
}
header{
  padding:12px;
  text-align:center;
  font-size:20px;
  background:#111b21;
}
#join{
  padding:10px;
  display:flex;
  gap:8px;
  justify-content:center;
}
input,button{
  padding:10px;
  border-radius:6px;
  border:none;
}
input{width:120px}
button{background:#25d366;font-weight:bold}
#videos{
  display:flex;
  gap:8px;
  padding:8px;
}
video{
  width:50%;
  background:#000;
  border-radius:8px;
  object-fit:cover;
  transform:scaleX(-1);
}
#chat{
  position:fixed;
  bottom:0;
  width:100%;
  background:#111b21;
}
#messages{
  max-height:150px;
  overflow:auto;
  padding:8px;
}
#send{
  display:flex;
}
#send input{
  flex:1;
}
</style>
</head>

<body>

<header>VCTube</header>

<div id="join">
  <input id="room" placeholder="Room Code">
  <button onclick="start()">Create / Join</button>
</div>

<div id="videos">
  <video id="local" autoplay muted playsinline></video>
  <video id="remote" autoplay playsinline></video>
</div>

<div id="chat">
  <div id="messages"></div>
  <div id="send">
    <input id="msg" placeholder="Type message">
    <button onclick="sendMsg()">Send</button>
  </div>
</div>

<script>
let peer, conn, call;

async function start(){
  let room = roomInput.value.trim();
  if(!room){
    room = Math.random().toString(36).substring(2,8).toUpperCase();
    alert("Room Code: " + room);
  }

  peer = new Peer(room);

  const stream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
  local.srcObject = stream;

  peer.on("call", c=>{
    c.answer(stream);
    c.on("stream", s=>remote.srcObject=s);
  });

  peer.on("connection", c=>{
    conn = c;
    conn.on("data", d=>addMsg("Friend", d));
  });

  peer.on("open", id=>{
    if(roomInput.value){
      call = peer.call(room, stream);
      call.on("stream", s=>remote.srcObject=s);
      conn = peer.connect(room);
      conn.on("data", d=>addMsg("Friend", d));
    }
  });
}

function sendMsg(){
  if(conn && msg.value){
    conn.send(msg.value);
    addMsg("You", msg.value);
    msg.value="";
  }
}

function addMsg(who,text){
  messages.innerHTML += `<div><b>${who}:</b> ${text}</div>`;
  messages.scrollTop = messages.scrollHeight;
}

const roomInput = document.getElementById("room");
const local = document.getElementById("local");
const remote = document.getElementById("remote");
const msg = document.getElementById("msg");
const messages = document.getElementById("messages");
</script>

</body>
</html>
